<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-submenu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-icons/image-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<!--
`<zrickr-drawer-content-item>` implements a menu content to a item
and their subitems if it has someone, or a simple menu tittle with its
corresponding events.

Example:

    <zrickr-drawer-content-item
      id="itemMenu1"
      icon="icons:settings"
      item-menu-name="Settings">
    </zrickr-drawer-content-item>

In case our items are able to add manually, it exists the possibility to
include a button to add a new item (view `add-item-tapped` event)

    <zrickr-drawer-content-item
      id="itemMenu2"
      icon="image:view-comfy"
      item-menu-name="My Collections"
      add
      item-name="collection"
      subitem-name="element"
      items="[{'name': 'Balls', 'public':true}, {'name': 'Coins', 'public':false}]">
    </zrickr-drawer-content-item>

If there are no subitems, we must no put `subitem-name` property

### Styling

The following custom properties are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--drawer-content-subitem-menu-border-color`| Border color of subitem menu | `--primary-text-color`

@element zrickr-drawer-setting
@demo ../../elements/zrickr-drawer/demo/index.html
-->

<dom-module id="zrickr-drawer-content-item">
  <style include="iron-flex iron-flex-alignment">
    paper-item {
      cursor: pointer;
    }

    paper-menu {
      padding: 0px;
    }

    paper-menu-button {
      padding: 0px;
    }

    iron-image {
      width: 18px;
      height: 18px;
      margin-right: 8px;
    }

    .item {
      @apply(--drawer-content-item);
    }

    .item-title {
      @apply(--drawer-title-item);
    }

    .item-list {
      @apply(--layout-vertical);
      overflow: auto;
      min-height: 0px;
    }

    .subitem {
      @apply(--drawer-content-subitem);
    }

    .subitem-title {
      @apply(--layout-flex);
      @apply(--layout-horizontal);
      margin-right: 8px;
    }

    .menu-button {
      margin-right: 4px;
      opacity: 0.75;
    }

    .menu-subitem {
      width: 150px;
      border: 1px solid var(--drawer-content-subitem-menu-border-color,
                            --primary-text-color);
      padding: 1px;
    }

    .menu-subitem-action {
      @apply(--layout-flex);
      @apply(--layout-horizontal);
      font-size: 12px;
      margin: 0px auto;
      min-height: 8px;
      padding: 0px 4px;
      min-height: 40px;
    }

    .menu-subitem-action paper-icon-button {
      width: 30px;
      height: 30px;
    }

    .space {
      border-bottom: 1px solid var(--divider-color);
      margin-bottom: 2px;
    }
  </style>

  <template>
    <paper-submenu>
      <paper-item class="menu-trigger item">
        <div class="item-title" on-tap="_itemTapped">
          <paper-icon-button icon="{{icon}}"></paper-icon-button>
          <span>[[itemMenuName]]</span>
        </div>
        <paper-icon-button
          hidden="{{!add}}"
          icon="icons:add"
          on-tap="_addItemTapped"
          class="menu-button">
          <paper-ripple></paper-ripple>
        </paper-icon-button>
      </paper-item>

      <paper-menu id="menuItem" role="listbox" class="menu-content item-list">
        <template is="dom-repeat" items="[[items]]" as="item">
          <paper-item class="subitem" id="item-{{index}}">
            <div class="subitem-title" on-tap="_viewSubitemTapped">
              <iron-image sizing="contain" src="../../images/zrickr.png"></iron-image>
              <span>[[item.name]]</span>
            </div>
            <paper-menu-button>
              <paper-icon-button
                icon="icons:more-vert"
                class="dropdown-trigger menu-button">
                <paper-ripple></paper-ripple>
              </paper-icon-button>
              <paper-menu id="menuSubitem" role="menu" class="dropdown-content menu-subitem">
                <paper-item hidden={{!subitemName}}
                            class="menu-subitem-action space"
                            on-tap="_addSubitemTapped">
                  <paper-icon-button icon="image:add-to-photos"></paper-icon-button>
                  Add a [[subitemName]]
                </paper-item>
                <paper-item class="menu-subitem-action"
                            on-tap="_viewItemTapped">
                  <paper-icon-button icon="image:remove-red-eye"></paper-icon-button>
                  View [[itemName]]
                </paper-item>
                <paper-item class="menu-subitem-action"
                            on-tap="_editItemTapped">
                  <paper-icon-button icon="icons:create"></paper-icon-button>
                  Edit [[itemName]]
                </paper-item>
                <paper-item class="menu-subitem-action"
                            on-tap="_deleteItemTapped">
                  <paper-icon-button icon="icons:close"></paper-icon-button>
                  Delete [[itemName]]
                </paper-item>
              </paper-menu>
            </paper-menu-button>
          </paper-item>
        </template>
      </paper-menu>
    </paper-submenu>
  </template>
</dom-module>

<script>
(function() {

  Polymer({

    is: "zrickr-drawer-content-item",

    properties: {
      /**
       * Index of active or selected item
       */
      activeItem: {
        type: Number,
        value: -1
      },
      /**
       * Database ID of active or selected item
       */
      activeID: {
        type: String,
        value: undefined
      },
      /**
       * If it should be a button to add a new item
       */
      add: {
        type: Boolean,
        value: false,
      },
      /**
       * Indicate the new password that the user wants to change
       */
      newPassword: {
        type: String,
        value: '',
      },
      /**
       * Main icon of the item title
       */
      icon: Object,
      /**
       * Item name of the menu
       */
      itemMenuName: {
        type: String,
        value: 'My Items',
        readonly: true
      },
      /**
       * Item name in singular
       */
      itemName: {
        type: String,
        value: 'item',
        readonly: true
      },
      /**
       * Subitems name in singular
       */
      subitemName: {
        type: String,
        value: '',
        readonly: true
      },
      /**
       * Array of main items
       */
      items: {
        type: Array,
        readonly: true
      }
    },

    listeners: {
      'paper-submenu-open': '_submenuOpen',
      'iron-activate': '_subitemActivate',
      'iron-select': '_subitemSelected'
    },

    observers: [
      '_activeItemChanged(activeItem, activeID)'
    ],

    attached() {
      if (!this.items || !this.itemMenuName) {
        let menuItem = this.$.menuItem;
        this.$.menuItem.remove();
      }
    },

    close() {
      this.$$('paper-submenu').close();
    },

    _submenuOpen(event) {
      this.fire('menu-opened', this);
    },

    _activeItemChanged(activeItem, activeID) {

    },

    _subitemActivate(event) {
      console.log("Subitem Activated", event.detail);
      let index = event.detail.selected;
      this.activeItem = index;
      let itemObject = this.items[index];
      let firebaseKey = itemObject.__firebaseKey__;
      this.activeID = firebaseKey;
      let itemAnchor = event.detail.item;
      let itemPaper = itemAnchor.firstChild;
      itemPaper.focused = true;
      console.log("index", index);
      console.log("itemObject", itemObject);
      console.log("itemPaper",itemPaper.focused);
      console.log("firebaseKey", firebaseKey);
    },

    _subitemSelected(event) {
    },

    /**
     * When the user tap on a item
     * @event item-tapped
     */
    _itemTapped(event) {
      this.fire("item-tapped", this);
    },

    /**
     * When the user tap on the add item button.
     * @event add-item-tapped
     */
    _addItemTapped(event) {
      this.fire("add-item-tapped", this);
      event.stopPropagation();
    },

    /**
     * When the user tap on a subitem
     * @event menu-subitem-tapped
     */
    _subitemTapped(event) {
      this.fire("subitem-tapped", this);
    },

    /**
     * When the user want to add a subitem on a item
     * @event view-item-tapped
     */
    _addSubitemTapped(event) {
      this.fire("add-subitem-tapped", this);
    },

    /**
     * When the user want to general view of a item
     * @event view-item-tapped
     */
    _viewItemTapped(event) {
      this.fire("view-item-tapped", this);
    },

    /**
     * When the user want to edit a item
     * @event edit-item-tapped
     */
    _editItemTapped(event) {
      this.fire("edit-item-tapped", this);
    },

    /**
     * When the user want to delete a item
     * @event delete-item-tapped
     */
    _deleteItemTapped(event) {
      this.fire("delete-item-tapped", this);
    },




    _changePasswordTapped() {
      this.fire("change-password-tapped", this);
    },

    _signoutTapped() {
      this.fire("signout-tapped");
    },
  });

})();
</script>
