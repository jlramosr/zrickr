<link rel="import" href="../../bower_components/polymer/polymer.html">

<script>
  /**
  `ZrickrCollectionNewBehavior` enables all common properties and behaviors
  of the new collection creation process.

  @demo demo/index.html
  @polymerBehavior ZrickrCollectionNewBehavior
  */
  ZrickrCollectionNewBehavior = {

    properties: {
      /**
       * Name of the collection will be created.
       */
      collectionName: String,
      /**
       * Type of collection (`custom` if it will be a custom collection or
       * `users` if the fields and properties of the new collection will get
       * by other public collection schemas).
       */
      optionSelected: {
        type: String,
        value: 'custom'
      },
      /**
       * Current step of the creation process.
       */
      currentStep: Number,
      /**
       * Total number of steps in the creation process.
       */
      numberSteps: {
        type: Number,
        value: 4,
        readonly: true
      },

      share: Array
    },

    listeners: {
      'dialog-confirm-tapped': '_nextStep',
      'dialog-back-tapped': '_previousStep'
    },

    attached() {
      if (this.currentStep < this.numberSteps) {
        this.$$('zrickr-dialog').labelConfirm = "Next";
      }
    },

    /**
     * Throw the dialog
     */
    toggle() {
      this.$$('zrickr-dialog').toggle();
    },

    /**
    * Included in the callback of `dialog-confirm-tapped` listener. All
    * elements have this behavior would have to implement this method.
    * @return {boolean} If all inputs have been correctly validated
    */
    nextStep() {
      return false;
    },

    /**
    * Included in the callback of `dialog-back-tapped` listener.
    * @return {boolean} If all inputs have been correctly validated
    */

    previousStep(event) {
      this._toggleBackDialog();
      return true;
    },

    /**
     * Function called when the user tap on the 'confirm' or 'next' button.
     */
    _nextStep(event) {
      if (this.$$('zrickr-dialog').id == event.detail.id) {
        if (this.nextStep()) {
          this.$$('zrickr-dialog').close();
        }
      }
    },

    /**
     * Function called when the user tap on the 'back'' button.
     */
    _previousStep(event) {
      if (this.$$('zrickr-dialog').id == event.detail.id) {
        this.previousStep();
      }
    },

    /**
     * Throw the next dialog in the creation process.
     * @param {string} selectorDialog Next dialog identified by selector.
     */
    _toggleNextDialog(selectorDialog) {
      newDialog = document.createElement(selectorDialog);
      newDialog.optionSelected = this.optionSelected;
      newDialog.collectionName = this.collectionName;
      newDialog.currentStep = this.currentStep + 1;
      newDialog.fields = this.fields;
      /*newDialog.share = this.share,*/
      this.appendChild(newDialog);
      newDialog.toggle();
    },

    /**
     * Throw the back dialog in the creation process.
     */
    _toggleBackDialog() {
      parentDialog = this.parentElement;
      parentDialog.toggle();
      /*parentDialog.fields = this.fields;*/
      /*console.log("NEXTnewDialog". parentDialog.fields);
      console.log("NEXTthisDialog". this.fields);*/
      this.remove();
    }
  };
</script>
