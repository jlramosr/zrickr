<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/carbon-route/carbon-route.html">
<link rel="import" href="../../bower_components/carbon-route/carbon-location.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../elements/zrickr-drawer/zrickr-drawer-toolbar.html">
<link rel="import" href="../../elements/zrickr-drawer/zrickr-drawer-content.html">
<link rel="import" href="../../elements/zrickr-main/zrickr-main-toolbar.html">
<link rel="import" href="../../elements/zrickr-main/zrickr-main-content.html">
<link rel="import" href="../../elements/zrickr-collection/zrickr-collection.html">
<link rel="import" href="../../elements/zrickr-collection/zrickr-collection-new.html">
<link rel="import" href="../../elements/zrickr-profile/zrickr-profile.html">

<!--
`<zrickr-app>` provides a web main structure with a drawer
and a main content

Example:

    <zrickr-app></zrickr-app>

@element zrickr-app
@demo demo/index.html
-->

<dom-module id="zrickr-app">
  <style include="iron-flex iron-flex-alignment shared-styles">
    :host {
      display: block;
    }
    #mainPanel {
      background: var(--main-panel-background-color, --primary-background-color);
      height: 100%;
    }
    #drawer {
      background: var(--drawer-background-color, --primary-background-color);
    }
    #main {
      background: var(--main-background-color, --primary-background-color);
    }
  </style>

  <template>
    <carbon-location use-hash-as-path route="{{route}}"></carbon-location>
    <carbon-route id="zrickrRoute" route="{{route}}" pattern="/:page"
                  tail="{{tail}}" data="{{data}}">
    </carbon-route>
    <paper-drawer-panel id="mainPanel">
      <paper-scroll-header-panel id="drawer" fixed drawer>
        <zrickr-drawer-toolbar
          class="paper-header"
          id="drawerToolbar">
        </zrickr-drawer-toolbar>
        <zrickr-drawer-content
          items="[[collections]]"
          primary-item-menu-name="My Collections"
          secondary-item-menu-name="My Shared Collections"
          item-name="collection"
          object-name="zrickr"
          id="drawerContent">
        </zrickr-drawer-content>
      </paper-scroll-header-panel>
      <paper-scroll-header-panel id="main" fixed main>
        <zrickr-main-toolbar
          auth={{auth}}
          class="paper-header"
          id="mainToolbar">
        </zrickr-main-toolbar>
        <zrickr-main-content
          items="{{collections}}"
          class="content"
          id="mainContent">
          <!--<iron-pages attr-for-selected="data-route" selected="{{route}}">
              <section id="load1" data-route="load1">load1</section>
              <section id="load2" data-route="load2">load2</section>
          </iron-pages>-->
        </zrickr-main-content>
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <zrickr-collection
      id="collectionHandler"
      location="[[auth.location]]"
      collections="{{collections}}">
    </zrickr-collection>
  </template>
</dom-module>

<!--<script src="../../bower_components/page/page.js"></script>-->

<script>
(function() {
  Polymer({
    is: 'zrickr-app',

    properties: {
      positionDrawer: {
        type: String,
        value: 'left'
      },
      /**
       * Authentication and backend information
       */
      auth: {
        type: Object,
      },
      collections: {
        type: Array,
        readonly: true
      }
    },

    listeners: {
      'drawer-menu-tapped': '_openDrawer',
      'add-item-tapped': '_newItemProcess',
      'add-item': '_addItem',
      'item-tapped': '_viewItem',
      'view-item-tapped': '_viewItem',
      'edit-profile-tapped': '_editProfile'
    },

    attached() {
      let route = this.$.zrickrRoute.data;
      if (route.page == 'profile') {
        this._editProfile();
      }
      let mainPanel = this.$.mainPanel;
      if (this.positionDrawer == 'right') {
        mainPanel.rightDrawer = true;
      }
    },


    /**
     * Add an element to the main content
     * @param elementName {String} The element to add as child of mainContent
     * @param headerTitle {String} The header of the new content
     */
    _addMainContent(elementName, headerTitle, route) {
      this.$.mainContent.lastChild.remove();
      let element = document.createElement(elementName);
      this.$.zrickrRoute.route.path = "/pppp";
      element.route = "lala";
      this.$.mainContent.appendChild(element);
      let header = document.createElement('h2');
      header.className = 'h';
      header.textContent= headerTitle;
      element.insertBefore(header, element.firstChild);
      //page.redirect('/' + route);
      return element;
    },

    /**
     * Fired when the user taps on menu button
     */
    _openDrawer() {
      let mainPanel = this.$.mainPanel;
      mainPanel.openDrawer();
    },

    /**
     * Fired when the user taps on add a new item in drawer. Add
     * the new process of collecion creation
     */
    _newItemProcess() {
      let newCollectionProcess =
        document.createElement('zrickr-collection-new');
      this.$.collectionHandler.appendChild(newCollectionProcess);
    },

    /**
     * Fired when the user taps on edit profile. Add the user profile
     * view to the main content
     */
    _editProfile() {
      let element = this._addMainContent('zrickr-profile',
                                         'User Profile',
                                         'profile');
      element.auth = this.auth;
    },

    /**
     * Fires when the process of creation has finished
     */
    _addItem(event) {
      let collection = event.detail;
      this.$.collectionHandler.add(collection);
    },

    /**
     * Fires when the user wants to view a subitem
     */
    _viewItem(event) {
      let collection = event.detail;
      console.log("VIEW", collection);
    }
  });
})();
</script>
