<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../elements/zrickr-drawer/zrickr-drawer-toolbar.html">
<link rel="import" href="../../elements/zrickr-drawer/zrickr-drawer-content.html">
<link rel="import" href="../../elements/zrickr-main/zrickr-main.html">
<link rel="import" href="../../elements/zrickr-collection/zrickr-collection.html">
<link rel="import" href="../../elements/zrickr-collection/zrickr-collection-new.html">

<!--
`<zrickr-app>` provides a web main structure with a drawer
and a main content

Example:

    <zrickr-app></zrickr-app>

@element zrickr-app
@demo demo/index.html
-->

<dom-module id="zrickr-app">
  <style include="iron-flex iron-flex-alignment">
    :host {
      display: block;
    }
    #mainPanel {
      background: var(--main-panel-background-color, --primary-background-color);
      height: 100%;
    }
    #drawer {
      background: var(--drawer-background-color, --primary-background-color);
    }
    #main {
      background: var(--main-background-color, --primary-background-color);
    }
  </style>

  <template>
    <paper-drawer-panel id="mainPanel">
      <paper-scroll-header-panel id="drawer" fixed condenses scroll-away-topbar drawer>
        <zrickr-drawer-toolbar
          class="paper-header"
          id="drawerToolbar">
        </zrickr-drawer-toolbar>
        <zrickr-drawer-content
          items="[[collections]]"
          primary-item-menu-name="My Collections"
          secondary-item-menu-name="My Shared Collections"
          item-name="collection"
          subitem-name="zrickr">
        </zrickr-drawer-content>
      </paper-scroll-header-panel>
      <paper-scroll-header-panel id="main" main condenses keep-condensed-header>
        <zrickr-main user={{user}} collections="{{collections}}"><zrickr-main>
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    <zrickr-collection
      id="collectionHandler"
      location="{{location}}"
      collections="{{collections}}">
    </zrickr-collection>
  </template>
</dom-module>

<script>
(function() {
  Polymer({
    is: 'zrickr-app',

    properties: {
      positionDrawer: {
        type: String,
        value: 'left'
      },
      user: {
        type: Object,
      },
      collections: {
        type: Array,
        readonly: true
      }
    },

    listeners: {
      'menu-tapped': '_openDrawer',
      'add-item-tapped': '_newItemProcess',
      'add-item': '_addItem'
    },

    attached() {
      let mainPanel = this.$.mainPanel;
      if (this.positionDrawer == 'right') {
        mainPanel.rightDrawer = true;
      }
    },

    /**
     * Fired when the user taps on menu button
     */
    _openDrawer(event) {
      let mainPanel = document.querySelector('#mainPanel');
      mainPanel.openDrawer();
    },

    /**
     * Fired when the user taps on add a new item in drawer
     */
    _newItemProcess(event) {
      let newCollectionProcess = document.createElement('zrickr-collection-new');
      this.$.collectionHandler.appendChild(newCollectionProcess);
    },

    /**
     * Fires when the process of creation has finished
     */
    _addItem(event) {
      let collection = event.detail;
      this.$.collectionHandler.add(collection);
    }
  });
})();
</script>
